# Guide de Containerisation Docker

Ce document explique comment utiliser la configuration Docker gÃ©nÃ©rÃ©e pour votre application Spring Boot.

## Table des MatiÃ¨res
1. [PrÃ©requis](#prÃ©requis)
2. [Structure des Fichiers](#structure-des-fichiers)
3. [Construction de l'Image Docker](#construction-de-limage-docker)
4. [ExÃ©cution du Container](#exÃ©cution-du-container)
5. [Docker Compose](#docker-compose)
6. [Gestion des Secrets](#gestion-des-secrets)
7. [DÃ©ploiement](#dÃ©ploiement)
8. [Bonnes Pratiques](#bonnes-pratiques)

## PrÃ©requis

Avant de commencer, assurez-vous d'avoir installÃ© :
- Docker Engine (version 20.10.0 ou supÃ©rieure)
- Docker Compose (version 2.0.0 ou supÃ©rieure)
<% if (dockerCompose) { %>
- Les services externes nÃ©cessaires (configurÃ©s dans docker-compose.yml)
<% } %>

## Structure des Fichiers

Votre projet contient dÃ©sormais les fichiers Docker suivants :

```
ğŸ“ projet-racine
â”œâ”€â”€ ğŸ“„ Dockerfile                 # Configuration principale du container Docker
â”œâ”€â”€ ğŸ“„ .dockerignore              # Liste des fichiers Ã  exclure du build Docker
â”œâ”€â”€ ğŸ“„ docker-compose.yml         # Configuration pour orchestrer plusieurs services
â””â”€â”€ ğŸ“ docker/
    â”œâ”€â”€ ğŸ“ scripts/               # Scripts utilitaires pour Docker
    â”‚   â”œâ”€â”€ ğŸ“„ build.sh           # Script pour construire l'image
    â”‚   â”œâ”€â”€ ğŸ“„ run.sh             # Script pour exÃ©cuter le container
    â”‚   â””â”€â”€ ğŸ“„ deploy.sh          # Script pour dÃ©ployer l'application
    â”œâ”€â”€ ğŸ“ secrets/               # Gestion des secrets
    â”‚   â”œâ”€â”€ ğŸ“„ secrets-example.env # Exemple de variables d'environnement
    â”‚   â””â”€â”€ ğŸ“„ manage-secrets.sh  # Script de gestion des secrets
    â””â”€â”€ ğŸ“ docs/                  # Documentation Docker
```

## Construction de l'Image Docker

<% if (multiStage) { %>
Votre application utilise un Dockerfile multi-stage pour optimiser la taille et la sÃ©curitÃ© de l'image finale.
<% } else { %>
Votre application utilise un Dockerfile simple qui crÃ©e une image Docker Ã  partir de votre application packagÃ©e.
<% } %>

### MÃ©thode Manuelle

Pour construire l'image Docker manuellement :

```bash
# Construction du projet (Maven ou Gradle)
<% if (buildTool === 'maven') { %>
./mvnw clean package -DskipTests
<% } else { %>
./gradlew clean build -x test
<% } %>

# Construction de l'image Docker
docker build -t <%= applicationName %>:latest .
```

### Utilisation du Script de Build

Vous pouvez Ã©galement utiliser le script de build fourni :

```bash
# Rendre le script exÃ©cutable
chmod +x docker/scripts/build.sh

# ExÃ©cuter le script
./docker/scripts/build.sh
```

Le script de build dÃ©tectera automatiquement la version de votre application depuis votre fichier de build et tagguera l'image en consÃ©quence.

## ExÃ©cution du Container

### MÃ©thode Manuelle

Pour exÃ©cuter votre container Docker manuellement :

```bash
docker run -d --name <%= applicationName %> -p <%= containerPort %>:<%= containerPort %> <%= applicationName %>:latest
```

### Utilisation du Script d'ExÃ©cution

Vous pouvez Ã©galement utiliser le script d'exÃ©cution fourni :

```bash
# Rendre le script exÃ©cutable
chmod +x docker/scripts/run.sh

# ExÃ©cuter le script
./docker/scripts/run.sh
```

## Docker Compose

<% if (dockerCompose) { %>
Le fichier `docker-compose.yml` permet d'orchestrer votre application avec les services dont elle dÃ©pend.

### Services Inclus

Votre configuration Docker Compose inclut les services suivants :

- **<%= applicationName %>** : Votre application Spring Boot
<% services.forEach(function(service) { %>
- **<%= service %>** : <%= service === 'postgres' ? 'PostgreSQL database' : service === 'mysql' ? 'MySQL database' : service === 'mongodb' ? 'MongoDB database' : service === 'redis' ? 'Redis cache' : service === 'elasticsearch' ? 'Elasticsearch search engine' : service === 'kibana' ? 'Kibana dashboard for Elasticsearch' : service === 'rabbitmq' ? 'RabbitMQ message broker' : service === 'kafka' ? 'Kafka streaming platform' : service === 'prometheus' ? 'Prometheus monitoring' : service === 'grafana' ? 'Grafana dashboards' : service %>
<% }); %>

### DÃ©marrer l'Environnement Complet

Pour dÃ©marrer tous les services dÃ©finis dans docker-compose.yml :

```bash
docker compose up -d
```

### ArrÃªter l'Environnement

Pour arrÃªter tous les services :

```bash
docker compose down
```
<% } else { %>
Docker Compose n'a pas Ã©tÃ© configurÃ© pour ce projet. Si vous souhaitez l'ajouter ultÃ©rieurement, vous pouvez rÃ©gÃ©nÃ©rer la configuration Docker avec l'option Docker Compose activÃ©e.
<% } %>

## Gestion des Secrets

Pour gÃ©rer les variables d'environnement et secrets de maniÃ¨re sÃ©curisÃ©e, un script utilitaire est fourni.

```bash
# Rendre le script exÃ©cutable
chmod +x docker/secrets/manage-secrets.sh

# CrÃ©er un fichier .env Ã  partir du modÃ¨le
cd docker/secrets
./manage-secrets.sh create

# Chiffrer le fichier .env pour un stockage sÃ©curisÃ©
./manage-secrets.sh encrypt

# DÃ©chiffrer un fichier .env.enc existant
./manage-secrets.sh decrypt
```

## DÃ©ploiement

Pour dÃ©ployer l'application sur un serveur distant :

```bash
# Rendre le script exÃ©cutable
chmod +x docker/scripts/deploy.sh

# DÃ©ployer sur un serveur distant (nÃ©cessite SSH)
REMOTE_HOST=your-server.com REMOTE_USER=your-username ./docker/scripts/deploy.sh
```

## Bonnes Pratiques

Consultez le document [docker-best-practices.md](./docker-best-practices.md) pour des conseils sur les meilleures pratiques Docker Ã  suivre pour votre application.
