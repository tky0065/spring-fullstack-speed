import { createRoot } from 'react-dom/client';
import { createInertiaApp } from '@inertiajs/react';
import { RoutingProvider } from './utils/routing';
import './styles/main.css';

/**
 * Initialisation de l'application Inertia avec React
 */
createInertiaApp({
  /**
   * Fonction pour résoudre les pages à partir de leurs noms
   * @param name - Nom de la page à charger
   */
  resolve: async (name: string) => {
    // Importation dynamique des pages basée sur leur nom
    const pages = import.meta.glob('./pages/**/*.tsx');
    const page = pages[`./pages/${name}.tsx`];

    if (!page) {
      throw new Error(`Page not found: ${name}`);
    }

    return (await page()).default;
  },

  /**
   * Configure le rendu de l'application avec le RoutingProvider
   * @param param0 - Propriétés pour le rendu
   */
  setup({ el, App, props }) {
    createRoot(el).render(
      <RoutingProvider>
        <App {...props} />
      </RoutingProvider>
    );
  },
});
